local medal_sinkholes_fn = require("prefabs/medal_sinkholes_fn")
--------------------------------------------------------------------------
--[[ 时空塌陷数据同步组件 ]]
--------------------------------------------------------------------------

return Class(function(self, inst)

assert(TheWorld.ismastersim, "时空塌陷数据同步组件不应该出现在客户端上")

--------------------------------------------------------------------------
--[[ Constants ]]
--------------------------------------------------------------------------

local BOULDERS =
{
    "cavein_boulder",
}

--------------------------------------------------------------------------
--[[ Member variables ]]
--------------------------------------------------------------------------

--Public
self.inst = inst

--Private
local _ismastershard = TheWorld.ismastershard

--------------------------------------------------------------------------
--[[ Private member functions ]]
--------------------------------------------------------------------------

--------------------------------------------------------------------------
--[[ Private event handlers ]]
--------------------------------------------------------------------------

local OnSinkholesUpdate = not _ismastershard and function(inst, data)
    if data then
        if data.attack or data.warn then
            for i, v in ipairs(AllPlayers) do
                if data.attack then
                    medal_sinkholes_fn.SpawnSinkhole(v,data)--生成地陷
                elseif data.warn then
                    medal_sinkholes_fn.DoTargetWarning(v)--警告
                end
            end
        end
    end
end or nil

--------------------------------------------------------------------------
--[[ Initialization ]]
--------------------------------------------------------------------------

--Register events
if not _ismastershard then
    inst:ListenForEvent("secondary_medalsinkholesupdate", OnSinkholesUpdate)
end

--------------------------------------------------------------------------
--[[ Update ]]
--------------------------------------------------------------------------

--------------------------------------------------------------------------
--[[ Save/Load ]]
--------------------------------------------------------------------------

--------------------------------------------------------------------------
--[[ Debug ]]
--------------------------------------------------------------------------

--------------------------------------------------------------------------
--[[ End ]]
--------------------------------------------------------------------------

end)
